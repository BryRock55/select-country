<mat-form-field
  [appearance]="appearance"
  [class.d-block]="extendWidth"
  [class.mdc-text-field--invalid]="this.required && !this.value"
>
  <mat-label *ngIf="label">{{ label }}</mat-label>
  <input
    *ngIf="!!formControl"
    autocomplete="off"
    [class]="class"
    [matAutocomplete]="this.countryAutocomplete"
    [placeholder]="this.placeHolder"
    [readonly]="this.readonly"
    [tabIndex]="tabIndex"
    [value]="formControl.value?.name"
    [formControl]="formControl"
    [name]="this.name"
    aria-label="country"
    matInput
    type="text"
  />
  <input
    *ngIf="!formControl"
    (input)="inputChanged($event?.target?.value)"
    autocomplete="off"
    [class]="class"
    [matAutocomplete]="this.countryAutocomplete"
    [placeholder]="this.placeHolder"
    [readonly]="this.readonly"
    [tabIndex]="tabIndex"
    [value]="
      showCallingCode
        ? this.value
          ? this.value?.name + ' (' + this.value?.callingCode + ')'
          : ''
        : this.value?.name
    "
    [required]="this.required"
    [disabled]="this.disabled || this.loadingDB"
    [name]="this.name"
    aria-label="country"
    matInput
    type="text"
  />
  <mat-progress-bar
    *ngIf="this.loadingDB || this.loading"
    mode="buffer"
  ></mat-progress-bar>
  <mat-autocomplete
    [panelWidth]="panelWidth"
    #countryAutocomplete="matAutocomplete"
    (optionSelected)="onOptionsSelected($event)"
  >
    <mat-option *ngFor="let country of filteredOptions" [value]="country.name">
      <div class="d-flex">
        <mat-icon [svgIcon]="country?.alpha2Code?.toLowerCase()"></mat-icon>
        <small
          class="country-list-item"
          [title]="[country?.name, country?.alpha3Code] | joinStrings"
          *ngIf="!showCallingCode"
          >{{ [country?.name, country?.alpha3Code] | joinStrings }}</small
        >
        <small
          class="country-list-item"
          [title]="
            [country?.name, '(' + country?.callingCode + ')']
              | joinStrings : ' '
          "
          *ngIf="showCallingCode"
          >{{
            [country?.name, "(" + country?.callingCode + ")"]
              | joinStrings : " "
          }}</small
        >
      </div>
    </mat-option>
  </mat-autocomplete>
  <div class="d-flex mr-1" matSuffix>
    <mat-icon
      *ngIf="this.value"
      [svgIcon]="this.value?.alpha2Code?.toLowerCase()"
      class="ml-1 s-20 secondary-text"
    ></mat-icon>
    <mat-icon
      class="ml-1"
      class="ml-1 cursor-pointer pos-rel"
      *ngIf="cleareable && !!value"
      (click)="clear()"
      >cancel</mat-icon
    >
  </div>
  <mat-error
    *ngIf="
      (formControl && formControl.invalid) ||
      (!formControl && required && !this.value)
    "
    >{{ error }}</mat-error
  >
</mat-form-field>
